<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRC Financial Reporting Analysis Dashboard</title>
    <style>
        :root {
            --primary-color: #1a237e;
            --secondary-color: #283593;
            --accent-color: #3949ab;
            --light-color: #e8eaf6;
            --danger-color: #d32f2f;
            --warning-color: #f57c00;
            --success-color: #388e3c;
            --border-radius: 8px;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .logo-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            transition: background 0.3s;
        }
        
        nav a:hover, nav a.active {
            background: rgba(255,255,255,0.1);
        }
        
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .company-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: white;
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        
        .company-selector select {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            min-width: 250px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-high { background: var(--danger-color); color: white; }
        .status-medium { background: var(--warning-color); color: white; }
        .status-low { background: var(--success-color); color: white; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
        }
        
        .section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light-color);
        }
        
        .section-header h2 {
            color: var(--primary-color);
            font-size: 1.5rem;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .data-table th {
            background: var(--light-color);
            color: var(--primary-color);
            text-align: left;
            padding: 1rem;
            font-weight: 600;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .data-table tr:hover {
            background: #f9f9f9;
        }
        
        .compliance-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .compliance-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .compliant { background: var(--success-color); }
        .partial { background: var(--warning-color); }
        .non-compliant { background: var(--danger-color); }
        
        .risk-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .risk-category {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--accent-color);
        }
        
        .risk-category.high { border-left-color: var(--danger-color); }
        .risk-category.medium { border-left-color: var(--warning-color); }
        .risk-category.low { border-left-color: var(--success-color); }
        
        .risk-category h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        
        .risk-list {
            list-style: none;
        }
        
        .risk-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .json-viewer {
            background: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
        }
        
        .tab-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--light-color);
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: var(--primary-color);
        }
        
        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: var(--light-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }
        
        .search-box {
            position: relative;
            margin-bottom: 2rem;
        }
        
        .search-box input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }
        
        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        footer {
            background: var(--primary-color);
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <div>
                    <h1>FRC Bangladesh</h1>
                    <div class="logo-subtitle">Financial Reporting Analysis Dashboard</div>
                </div>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="active" data-tab="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="#" data-tab="analysis"><i class="fas fa-chart-bar"></i> Analysis</a></li>
                    <li><a href="#" data-tab="compliance"><i class="fas fa-check-circle"></i> Compliance</a></li>
                    <li><a href="#" data-tab="risk"><i class="fas fa-exclamation-triangle"></i> Risk Assessment</a></li>
                    <li><a href="#" data-tab="raw"><i class="fas fa-code"></i> Raw Data</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="dashboard-header">
            <div class="company-selector">
                <label for="companySelect"><strong>Select Company:</strong></label>
                <select id="companySelect">
                    <option value="">Loading companies...</option>
                </select>
                <div id="companyStatus" class="status-badge">N/A</div>
            </div>
            <div class="last-updated">
                Last Analysis: <span id="lastUpdatedDate">N/A</span>
            </div>
        </div>

        <div id="loading" class="loading">
            <i class="fas fa-spinner fa-spin fa-3x"></i>
            <p>Loading company data...</p>
        </div>

        <div id="dashboardContent" style="display: none;">
            <div class="stats-grid" id="statsGrid">
                <!-- Stats will be populated here -->
            </div>

            <div class="tab-container">
                <button class="tab active" data-target="executive">Executive Summary</button>
                <button class="tab" data-target="entity">Entity Context</button>
                <button class="tab" data-target="financial">Financial Analysis</button>
                <button class="tab" data-target="ifrs">IFRS Compliance</button>
                <button class="tab" data-target="audit">Audit & Governance</button>
                <button class="tab" data-target="departures">Material Departures</button>
            </div>

            <div class="tab-content active" id="executive">
                <div class="section">
                    <div class="section-header">
                        <h2>Executive Summary & Overall Conclusion</h2>
                        <div id="overallRisk" class="status-badge">N/A</div>
                    </div>
                    <div id="executiveContent">
                        <!-- Executive summary will be populated here -->
                    </div>
                </div>
            </div>

            <div class="tab-content" id="entity">
                <div class="section">
                    <div class="section-header">
                        <h2>Entity Context & Framework</h2>
                    </div>
                    <div id="entityContent">
                        <!-- Entity context will be populated here -->
                    </div>
                </div>
            </div>

            <div class="tab-content" id="financial">
                <div class="section">
                    <div class="section-header">
                        <h2>Financial Ratio & Trend Analysis</h2>
                    </div>
                    <div id="financialContent">
                        <!-- Financial analysis will be populated here -->
                    </div>
                </div>
            </div>

            <div class="tab-content" id="ifrs">
                <div class="section">
                    <div class="section-header">
                        <h2>In-Depth IFRS Compliance Review</h2>
                    </div>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="ifrsSearch" placeholder="Search IFRS standards...">
                    </div>
                    <div id="ifrsContent">
                        <!-- IFRS compliance will be populated here -->
                    </div>
                </div>
            </div>

            <div class="tab-content" id="audit">
                <div class="section">
                    <div class="section-header">
                        <h2>Audit Report & Corporate Governance Assessment</h2>
                    </div>
                    <div id="auditContent">
                        <!-- Audit and governance will be populated here -->
                    </div>
                </div>
            </div>

            <div class="tab-content" id="departures">
                <div class="section">
                    <div class="section-header">
                        <h2>Consolidated Table of Material Departures & Non-Compliance</h2>
                    </div>
                    <div id="departuresContent">
                        <!-- Material departures will be populated here -->
                    </div>
                </div>
            </div>

            <div class="tab-content" id="analysis">
                <div class="section">
                    <div class="section-header">
                        <h2>Comprehensive Analysis Overview</h2>
                    </div>
                    <div id="analysisContent">
                        <!-- Analysis content will be populated here -->
                    </div>
                </div>
            </div>

            <div class="tab-content" id="compliance">
                <div class="section">
                    <div class="section-header">
                        <h2>Compliance Status Dashboard</h2>
                    </div>
                    <div id="complianceContent">
                        <!-- Compliance dashboard will be populated here -->
                    </div>
                </div>
            </div>

            <div class="tab-content" id="risk">
                <div class="section">
                    <div class="section-header">
                        <h2>Integrated Risk Assessment</h2>
                    </div>
                    <div id="riskContent">
                        <!-- Risk assessment will be populated here -->
                    </div>
                </div>
            </div>

            <div class="tab-content" id="raw">
                <div class="section">
                    <div class="section-header">
                        <h2>Raw JSON Data Viewer</h2>
                        <select id="jsonSectionSelect">
                            <option value="all">All Sections</option>
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                    <div class="json-viewer" id="jsonViewer">
                        <!-- JSON data will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <div id="emptyState" class="empty-state" style="display: none;">
            <i class="fas fa-building fa-3x" style="color: #ccc; margin-bottom: 1rem;"></i>
            <h3>No Company Selected</h3>
            <p>Please select a company from the dropdown above to view its analysis.</p>
        </div>
    </div>

    <footer>
        <p>Financial Reporting Council (FRC) Bangladesh &copy; 2024</p>
        <p>This dashboard is for regulatory analysis purposes only.</p>
    </footer>

    <script>
        // Global variables
        let currentCompany = null;
        let allCompanies = [];
        let companyData = {};

        // Initialize the application
        document.addEventListener('DOMContentLoaded', async function() {
            await discoverCompanies();
            setupEventListeners();
            updateLastUpdated();
        });

        // Discover available companies in the dataset folder
        async function discoverCompanies() {
            try {
                // For demonstration, we'll create some sample companies
                // In a real implementation, you would scan the directory structure
                allCompanies = [
                    { id: 'company1', name: 'ABC Corporation Ltd.', status: 'medium', lastAnalyzed: '2024-01-15' },
                    { id: 'company2', name: 'XYZ Manufacturing PLC', status: 'high', lastAnalyzed: '2024-01-10' },
                    { id: 'company3', name: 'Global Textiles Inc.', status: 'low', lastAnalyzed: '2024-01-18' },
                    { id: 'company4', name: 'Bangladesh Pharma Ltd.', status: 'medium', lastAnalyzed: '2024-01-12' }
                ];

                const select = document.getElementById('companySelect');
                select.innerHTML = '<option value="">Select a company...</option>';
                
                allCompanies.forEach(company => {
                    const option = document.createElement('option');
                    option.value = company.id;
                    option.textContent = company.name;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error discovering companies:', error);
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            // Company selection
            document.getElementById('companySelect').addEventListener('change', async function(e) {
                const companyId = e.target.value;
                if (companyId) {
                    await loadCompanyData(companyId);
                } else {
                    showEmptyState();
                }
            });

            // Tab navigation
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    
                    // Update main tabs
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    const targetContent = document.getElementById(targetId);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                });
            });

            // Navigation tabs
            document.querySelectorAll('nav a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab');
                    
                    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    document.getElementById(tabId).classList.add('active');
                    
                    // Also update the tab container if it's a main section
                    const mainTab = document.querySelector(`.tab[data-target="${tabId}"]`);
                    if (mainTab) {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        mainTab.classList.add('active');
                    }
                });
            });

            // IFRS search
            document.getElementById('ifrsSearch').addEventListener('input', function(e) {
                filterIFRSTable(e.target.value);
            });
        }

        // Load company data from JSON files
        async function loadCompanyData(companyId) {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('dashboardContent').style.display = 'none';
            document.getElementById('emptyState').style.display = 'none';

            try {
                companyData = {};
                
                // Load all JSON files for the company (1-26)
                for (let i = 1; i <= 26; i++) {
                    try {
                        const response = await fetch(`dataset/${companyId}/${i}.json`);
                        if (response.ok) {
                            const data = await response.json();
                            companyData[i] = data;
                        }
                    } catch (error) {
                        console.warn(`Could not load section ${i} for ${companyId}:`, error);
                    }
                }

                // Update UI with loaded data
                updateDashboard(companyId);
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';
                
            } catch (error) {
                console.error('Error loading company data:', error);
                document.getElementById('loading').style.display = 'none';
                showEmptyState();
            }
        }

        // Update the dashboard with company data
        function updateDashboard(companyId) {
            const company = allCompanies.find(c => c.id === companyId);
            if (!company) return;

            currentCompany = company;
            
            // Update company status
            const statusBadge = document.getElementById('companyStatus');
            statusBadge.textContent = company.status.toUpperCase();
            statusBadge.className = `status-badge status-${company.status}`;

            // Update stats grid
            updateStatsGrid();

            // Update all sections
            updateExecutiveSummary();
            updateEntityContext();
            updateFinancialAnalysis();
            updateIFRSCompliance();
            updateAuditGovernance();
            updateMaterialDepartures();
            updateAnalysisOverview();
            updateComplianceDashboard();
            updateRiskAssessment();
            updateRawDataViewer();

            // Update last updated date
            document.getElementById('lastUpdatedDate').textContent = company.lastAnalyzed;
        }

        // Update statistics grid
        function updateStatsGrid() {
            const statsGrid = document.getElementById('statsGrid');
            
            // Extract data from the loaded JSON files
            const entityData = companyData[2]?.frc_analysis_report?.entity?.entity_profile || {};
            const materiality = companyData[3]?.frc_analysis_report?.entity?.materiality_framework || {};
            const fraudRisk = companyData[13]?.frc_analysis_report?.entity?.fraud_and_management_override_assessment || {};
            const overallAssessment = companyData[26]?.frc_analysis_report?.entity?.phase_5_synthesis_and_findings?.frca_executive_summary || {};
            
            const stats = [
                {
                    title: "Overall Risk Level",
                    value: overallAssessment.overall_fairness_assessment?.reliability_rating || "Medium",
                    color: getRiskColor(overallAssessment.overall_fairness_assessment?.reliability_rating || "Medium")
                },
                {
                    title: "IFRS Compliance",
                    value: overallAssessment.overall_fairness_assessment?.compliance_level_assessment || "N/A"
                },
                {
                    title: "Materiality Amount",
                    value: materiality.quantitative_materiality?.overall_materiality_amount || "N/A"
                },
                {
                    title: "Critical Issues",
                    value: overallAssessment.critical_issues_summary?.length || 0
                },
                {
                    title: "Material Departures",
                    value: companyData[16]?.frc_analysis_report?.entity?.phase_5_synthesis_and_findings?.material_departures_summary?.length || 0
                },
                {
                    title: "Audit Opinion",
                    value: companyData[14]?.frc_analysis_report?.entity?.phase_4_audit_governance_verification?.audit_report_analysis?.audit_opinion?.opinion_type || "N/A"
                }
            ];

            statsGrid.innerHTML = stats.map(stat => `
                <div class="stat-card">
                    <h3>${stat.title}</h3>
                    <div class="stat-value" style="color: ${stat.color || '#333'}">${stat.value}</div>
                </div>
            `).join('');
        }

        // Update executive summary
        function updateExecutiveSummary() {
            const executiveContent = document.getElementById('executiveContent');
            const overallAssessment = companyData[26]?.frc_analysis_report?.entity?.phase_5_synthesis_and_findings?.frca_executive_summary || {};
            const entityProfile = companyData[2]?.frc_analysis_report?.entity?.entity_profile || {};
            
            const overallRisk = overallAssessment.overall_fairness_assessment?.reliability_rating || "Medium";
            document.getElementById('overallRisk').textContent = overallRisk.toUpperCase();
            document.getElementById('overallRisk').className = `status-badge status-${overallRisk.toLowerCase()}`;
            
            executiveContent.innerHTML = `
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">${entityProfile.legal_name || 'Company'} - ${entityProfile.financial_year_end || 'Financial Year'}</h3>
                    <p style="margin-bottom: 1rem;"><strong>True and Fair View Conclusion:</strong> ${overallAssessment.overall_fairness_assessment?.true_and_fair_view_conclusion || 'Not Available'}</p>
                    <p style="margin-bottom: 1rem;"><strong>Basis for Conclusion:</strong> ${overallAssessment.overall_fairness_assessment?.basis_for_conclusion || 'Not Available'}</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    <div class="risk-category ${getRiskClass(overallRisk)}">
                        <h3>Overall Reliability Rating: ${overallRisk}</h3>
                        <p>Based on comprehensive analysis of IFRS compliance, audit quality, governance, earnings quality, and disclosure transparency.</p>
                    </div>
                </div>
                
                ${overallAssessment.critical_issues_summary?.length > 0 ? `
                <div style="margin-bottom: 2rem;">
                    <h4 style="color: var(--danger-color); margin-bottom: 1rem;">Critical Issues Identified</h4>
                    <ul style="list-style: none;">
                        ${overallAssessment.critical_issues_summary.map(issue => `
                            <li style="padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                                <strong style="color: ${getPriorityColor(issue.issue_priority)}">${issue.issue_priority}:</strong> ${issue.issue_description || 'No description'}
                                ${issue.financial_impact ? `<br><small>Financial Impact: ${issue.financial_impact}</small>` : ''}
                            </li>
                        `).join('')}
                    </ul>
                </div>
                ` : ''}
                
                ${overallAssessment.key_strengths_identified?.length > 0 ? `
                <div style="margin-bottom: 2rem;">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">Key Strengths</h4>
                    <ul>
                        ${overallAssessment.key_strengths_identified.map(strength => `<li>${strength}</li>`).join('')}
                    </ul>
                </div>
                ` : ''}
                
                ${overallAssessment.frca_final_recommendations ? `
                <div>
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">FRC Recommendations</h4>
                    ${overallAssessment.frca_final_recommendations.immediate_actions_required?.length > 0 ? `
                    <div style="margin-bottom: 1rem;">
                        <h5>Immediate Actions Required:</h5>
                        <ul>
                            ${overallAssessment.frca_final_recommendations.immediate_actions_required.map(action => `<li>${action}</li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    
                    ${overallAssessment.frca_final_recommendations.medium_term_improvements?.length > 0 ? `
                    <div style="margin-bottom: 1rem;">
                        <h5>Medium-Term Improvements:</h5>
                        <ul>
                            ${overallAssessment.frca_final_recommendations.medium_term_improvements.map(improvement => `<li>${improvement}</li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    
                    ${overallAssessment.frca_final_recommendations.regulatory_reporting_requirements?.length > 0 ? `
                    <div>
                        <h5>Regulatory Reporting Requirements:</h5>
                        <ul>
                            ${overallAssessment.frca_final_recommendations.regulatory_reporting_requirements.map(req => `<li>${req}</li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                </div>
                ` : ''}
            `;
        }

        // Update entity context
        function updateEntityContext() {
            const entityContent = document.getElementById('entityContent');
            const entityProfile = companyData[2]?.frc_analysis_report?.entity?.entity_profile || {};
            const framework = companyData[5]?.frc_analysis_report?.entity?.phase_1_foundational_checks || {};
            const materiality = companyData[3]?.frc_analysis_report?.entity?.materiality_framework || {};
            
            entityContent.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                    <div>
                        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Entity Profile</h3>
                        <table style="width: 100%;">
                            <tr><td style="padding: 0.5rem 0;"><strong>Legal Name:</strong></td><td>${entityProfile.legal_name || 'N/A'}</td></tr>
                            <tr><td style="padding: 0.5rem 0;"><strong>Trade Name:</strong></td><td>${entityProfile.trade_name || 'N/A'}</td></tr>
                            <tr><td style="padding: 0.5rem 0;"><strong>Registration No:</strong></td><td>${entityProfile.registration_number || 'N/A'}</td></tr>
                            <tr><td style="padding: 0.5rem 0;"><strong>Industry Sector:</strong></td><td>${entityProfile.industry_sector || 'N/A'}</td></tr>
                            <tr><td style="padding: 0.5rem 0;"><strong>Listing Status:</strong></td><td>${entityProfile.listing_status || 'N/A'}</td></tr>
                            <tr><td style="padding: 0.5rem 0;"><strong>Stock Symbol:</strong></td><td>${entityProfile.stock_exchange_symbol || 'N/A'}</td></tr>
                            <tr><td style="padding: 0.5rem 0;"><strong>Financial Year End:</strong></td><td>${entityProfile.financial_year_end || 'N/A'}</td></tr>
                            <tr><td style="padding: 0.5rem 0;"><strong>Report Date:</strong></td><td>${entityProfile.report_publication_date || 'N/A'}</td></tr>
                        </table>
                    </div>
                    
                    <div>
                        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Reporting Framework</h3>
                        <p><strong>Disclosed Framework:</strong> ${framework.reporting_framework?.disclosed_framework || 'N/A'}</p>
                        <p><strong>Compliance Assessment:</strong> ${framework.reporting_framework?.compliance_assessment || 'N/A'}</p>
                        
                        ${framework.reporting_framework?.discrepancies_identified?.length > 0 ? `
                        <div style="margin-top: 1rem;">
                            <h4 style="color: var(--warning-color);">Discrepancies Identified:</h4>
                            <ul>
                                ${framework.reporting_framework.discrepancies_identified.map(d => `<li>${d}</li>`).join('')}
                            </ul>
                        </div>
                        ` : ''}
                        
                        <h3 style="color: var(--primary-color); margin-top: 1.5rem; margin-bottom: 1rem;">Regulatory Compliance</h3>
                        <p><strong>Overall Assessment:</strong> ${framework.regulatory_landscape?.overall_regulatory_assessment || 'N/A'}</p>
                        
                        ${framework.regulatory_landscape?.applicable_regulators?.length > 0 ? `
                        <div style="margin-top: 1rem;">
                            <h4>Applicable Regulators:</h4>
                            <ul>
                                ${framework.regulatory_landscape.applicable_regulators.map(reg => `
                                    <li>${reg.regulator_name} - ${reg.compliance_status || 'Status N/A'}</li>
                                `).join('')}
                            </ul>
                        </div>
                        ` : ''}
                    </div>
                </div>
                
                ${materiality.quantitative_materiality || materiality.qualitative_materiality_considerations ? `
                <div style="margin-top: 2rem;">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Materiality Framework</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        ${materiality.quantitative_materiality ? `
                        <div>
                            <h4>Quantitative Materiality</h4>
                            <table style="width: 100%;">
                                ${materiality.quantitative_materiality.benchmark_used ? `<tr><td style="padding: 0.5rem 0;"><strong>Benchmark:</strong></td><td>${materiality.quantitative_materiality.benchmark_used}</td></tr>` : ''}
                                ${materiality.quantitative_materiality.percentage_applied ? `<tr><td style="padding: 0.5rem 0;"><strong>Percentage:</strong></td><td>${materiality.quantitative_materiality.percentage_applied}</td></tr>` : ''}
                                ${materiality.quantitative_materiality.overall_materiality_amount ? `<tr><td style="padding: 0.5rem 0;"><strong>Overall Materiality:</strong></td><td>${materiality.quantitative_materiality.overall_materiality_amount}</td></tr>` : ''}
                            </table>
                        </div>
                        ` : ''}
                        
                        ${materiality.qualitative_materiality_considerations?.length > 0 ? `
                        <div>
                            <h4>Qualitative Considerations</h4>
                            <ul>
                                ${materiality.qualitative_materiality_considerations.map(consideration => `<li>${consideration}</li>`).join('')}
                            </ul>
                        </div>
                        ` : ''}
                    </div>
                    
                    ${materiality.frc_materiality_conclusion ? `
                    <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius);">
                        <strong>FRC Materiality Conclusion:</strong> ${materiality.frc_materiality_conclusion}
                    </div>
                    ` : ''}
                </div>
                ` : ''}
            `;
        }

        // Update financial analysis
        function updateFinancialAnalysis() {
            const financialContent = document.getElementById('financialContent');
            const ratioData = companyData[6]?.frc_analysis_report?.entity?.phase_2_financial_analysis || {};
            const enhancedRatios = companyData[19]?.frc_analysis_report?.entity?.phase_2_financial_analysis?.enhanced_ratio_analysis || {};
            const earningsQuality = companyData[17]?.frc_analysis_report?.entity?.phase_2_financial_analysis?.detailed_earnings_quality_analysis || {};
            const trendAnalysis = companyData[18]?.frc_analysis_report?.entity?.phase_2_financial_analysis?.detailed_trend_analysis || {};
            
            financialContent.innerHTML = `
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Key Financial Ratios</h3>
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ratio</th>
                                    <th>Current Year</th>
                                    <th>Previous Year</th>
                                    <th>Trend</th>
                                    <th>Assessment</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${generateRatioRows(enhancedRatios, ratioData)}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                ${earningsQuality.total_accruals_calculation ? `
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Earnings Quality Analysis</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h4>Total Accruals Calculation</h4>
                            ${Object.entries(earningsQuality.total_accruals_calculation).filter(([key]) => key.startsWith('year')).map(([yearKey, data]) => `
                                <div style="margin-bottom: 1rem; padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius);">
                                    <strong>${yearKey.replace('_', ' ').toUpperCase()}:</strong>
                                    ${data.net_income ? `<br>Net Income: ${data.net_income}` : ''}
                                    ${data.cash_flow_from_operations ? `<br>Cash from Operations: ${data.cash_flow_from_operations}` : ''}
                                    ${data.total_accruals ? `<br>Total Accruals: ${data.total_accruals}` : ''}
                                    ${data.accruals_to_net_income_ratio ? `<br>Accruals/Net Income: ${data.accruals_to_net_income_ratio}` : ''}
                                </div>
                            `).join('')}
                            
                            ${earningsQuality.total_accruals_calculation.trend_assessment ? `
                            <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius);">
                                <strong>Trend Assessment:</strong> ${earningsQuality.total_accruals_calculation.trend_assessment}
                            </div>
                            ` : ''}
                        </div>
                        
                        ${earningsQuality.revenue_quality_indicators ? `
                        <div>
                            <h4>Revenue Quality Indicators</h4>
                            <div style="padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius);">
                                ${earningsQuality.revenue_quality_indicators.revenue_growth_vs_cash_collection ? `
                                <p><strong>Revenue Growth vs Cash Collection:</strong> ${earningsQuality.revenue_quality_indicators.revenue_growth_vs_cash_collection}</p>
                                ` : ''}
                                ${earningsQuality.revenue_quality_indicators.accounting_policy_changes_impact ? `
                                <p><strong>Policy Changes Impact:</strong> ${earningsQuality.revenue_quality_indicators.accounting_policy_changes_impact}</p>
                                ` : ''}
                                ${earningsQuality.revenue_quality_indicators.risk_assessment ? `
                                <p><strong>Risk Assessment:</strong> ${earningsQuality.revenue_quality_indicators.risk_assessment}</p>
                                ` : ''}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
                ` : ''}
                
                ${trendAnalysis.horizontal_analysis_yoy ? `
                <div>
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Trend Analysis</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        ${trendAnalysis.horizontal_analysis_yoy.statement_of_financial_position?.length > 0 ? `
                        <div>
                            <h4>Statement of Financial Position Trends</h4>
                            <div style="max-height: 300px; overflow-y: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Line Item</th>
                                            <th>Current</th>
                                            <th>Previous</th>
                                            <th>Change</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${trendAnalysis.horizontal_analysis_yoy.statement_of_financial_position.map(item => `
                                            <tr>
                                                <td>${item.line_item}</td>
                                                <td>${item.year_yyyy || 'N/A'}</td>
                                                <td>${item.year_yyyy_1 || 'N/A'}</td>
                                                <td>${item.percentage_change || 'N/A'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        ` : ''}
                        
                        ${trendAnalysis.horizontal_analysis_yoy.statement_of_profit_or_loss?.length > 0 ? `
                        <div>
                            <h4>Statement of Profit or Loss Trends</h4>
                            <div style="max-height: 300px; overflow-y: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Line Item</th>
                                            <th>Current</th>
                                            <th>Previous</th>
                                            <th>Change</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${trendAnalysis.horizontal_analysis_yoy.statement_of_profit_or_loss.map(item => `
                                            <tr>
                                                <td>${item.line_item}</td>
                                                <td>${item.year_yyyy || 'N/A'}</td>
                                                <td>${item.year_yyyy_1 || 'N/A'}</td>
                                                <td>${item.percentage_change || 'N/A'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
                ` : ''}
            `;
        }

        // Update IFRS compliance
        function updateIFRSCompliance() {
            const ifrsContent = document.getElementById('ifrsContent');
            const complianceMatrix = companyData[12]?.frc_analysis_report?.entity?.phase_3_ifrs_compliance_detailed?.detailed_ifrs_compliance_matrix || [];
            const standardChecks = companyData[8]?.frc_analysis_report?.entity?.phase_3_ifrs_compliance_detailed?.key_standards_compliance_check || {};
            
            // Populate JSON section selector
            const sectionSelect = document.getElementById('jsonSectionSelect');
            sectionSelect.innerHTML = '<option value="all">All Sections</option>';
            for (let i = 1; i <= 26; i++) {
                if (companyData[i]) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Section ${i}`;
                    sectionSelect.appendChild(option);
                }
            }
            
            ifrsContent.innerHTML = `
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">IFRS Compliance Matrix</h3>
                    ${complianceMatrix.length > 0 ? `
                    <div style="max-height: 500px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Standard Code</th>
                                    <th>Standard Name</th>
                                    <th>Applicability</th>
                                    <th>Compliance Status</th>
                                    <th>Page Reference</th>
                                    <th>Concerns</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${complianceMatrix.map(item => `
                                    <tr>
                                        <td><strong>${item.standard_code || 'N/A'}</strong></td>
                                        <td>${item.standard_name || 'N/A'}</td>
                                        <td>${item.applicability || 'N/A'}</td>
                                        <td>
                                            <div class="compliance-status">
                                                <span class="compliance-dot ${getComplianceClass(item.compliance_status)}"></span>
                                                ${item.compliance_status || 'N/A'}
                                            </div>
                                        </td>
                                        <td>${item.page_reference || 'N/A'}</td>
                                        <td>${item.material_departures?.join(', ') || 'None'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    ` : `
                    <div class="empty-state">
                        <p>No compliance matrix data available for this company.</p>
                    </div>
                    `}
                </div>
                
                ${Object.keys(standardChecks).length > 0 ? `
                <div>
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Key Standards Compliance Check</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem;">
                        ${Object.entries(standardChecks).map(([standard, data]) => `
                            <div style="padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius); border-left: 4px solid var(--accent-color);">
                                <h4 style="color: var(--primary-color); margin-bottom: 0.5rem;">${standard.replace(/_/g, ' ').toUpperCase()}</h4>
                                <div style="font-size: 0.9rem;">
                                    ${Object.entries(data).map(([key, value]) => {
                                        if (Array.isArray(value)) {
                                            return `<p><strong>${key}:</strong> ${value.join(', ') || 'N/A'}</p>`;
                                        } else if (typeof value === 'object' && value !== null) {
                                            return `<p><strong>${key}:</strong> [Object]</p>`;
                                        } else {
                                            return `<p><strong>${key}:</strong> ${value || 'N/A'}</p>`;
                                        }
                                    }).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            `;
        }

        // Update audit and governance
        function updateAuditGovernance() {
            const auditContent = document.getElementById('auditContent');
            const auditReport = companyData[14]?.frc_analysis_report?.entity?.phase_4_audit_governance_verification || {};
            const enhancedAudit = companyData[21]?.frc_analysis_report?.entity?.phase_4_audit_governance_verification?.enhanced_audit_report_analysis || {};
            const governance = companyData[22]?.frc_analysis_report?.entity?.phase_4_audit_governance_verification?.corporate_governance_code_assessment || {};
            
            auditContent.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                    <div>
                        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Audit Report Analysis</h3>
                        ${auditReport.audit_report_analysis ? `
                        <div>
                            <h4>Auditor Information</h4>
                            <div style="padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius); margin-bottom: 1rem;">
                                ${auditReport.audit_report_analysis.auditor_information?.firm_name ? `<p><strong>Firm:</strong> ${auditReport.audit_report_analysis.auditor_information.firm_name}</p>` : ''}
                                ${auditReport.audit_report_analysis.auditor_information?.audit_tenure_years ? `<p><strong>Tenure:</strong> ${auditReport.audit_report_analysis.auditor_information.audit_tenure_years} years</p>` : ''}
                                ${auditReport.audit_report_analysis.auditor_information?.rotation_compliance ? `<p><strong>Rotation Compliance:</strong> ${auditReport.audit_report_analysis.auditor_information.rotation_compliance}</p>` : ''}
                            </div>
                            
                            <h4>Audit Opinion</h4>
                            <div style="padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius); margin-bottom: 1rem;">
                                ${auditReport.audit_report_analysis.audit_opinion?.opinion_type ? `<p><strong>Type:</strong> ${auditReport.audit_report_analysis.audit_opinion.opinion_type}</p>` : ''}
                                ${auditReport.audit_report_analysis.audit_opinion?.basis_for_opinion ? `<p><strong>Basis:</strong> ${auditReport.audit_report_analysis.audit_opinion.basis_for_opinion}</p>` : ''}
                            </div>
                            
                            ${enhancedAudit.going_concern_analysis ? `
                            <h4>Going Concern Analysis</h4>
                            <div style="padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius);">
                                ${enhancedAudit.going_concern_analysis.auditor_conclusion ? `<p><strong>Auditor Conclusion:</strong> ${enhancedAudit.going_concern_analysis.auditor_conclusion}</p>` : ''}
                                ${enhancedAudit.going_concern_analysis.frca_assessment ? `<p><strong>FRC Assessment:</strong> ${enhancedAudit.going_concern_analysis.frca_assessment}</p>` : ''}
                            </div>
                            ` : ''}
                        </div>
                        ` : '<p>No audit report data available.</p>'}
                    </div>
                    
                    <div>
                        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Corporate Governance</h3>
                        ${governance.bsec_corporate_governance_code ? `
                        <div>
                            <h4>BSEC Compliance</h4>
                            ${governance.bsec_corporate_governance_code.overall_compliance_score ? `
                            <div style="padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius); margin-bottom: 1rem;">
                                <p><strong>Overall Compliance Score:</strong> ${governance.bsec_corporate_governance_code.overall_compliance_score}</p>
                            </div>
                            ` : ''}
                            
                            ${governance.bsec_corporate_governance_code.compliance_checklist?.length > 0 ? `
                            <div style="max-height: 300px; overflow-y: auto; margin-bottom: 1rem;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Requirement</th>
                                            <th>Status</th>
                                            <th>Page Ref</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${governance.bsec_corporate_governance_code.compliance_checklist.map(item => `
                                            <tr>
                                                <td>${item.requirement}</td>
                                                <td>
                                                    <div class="compliance-status">
                                                        <span class="compliance-dot ${getComplianceClass(item.compliance_status)}"></span>
                                                        ${item.compliance_status || 'N/A'}
                                                    </div>
                                                </td>
                                                <td>${item.page_reference || 'N/A'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            ` : ''}
                        </div>
                        ` : ''}
                        
                        ${governance.board_committee_effectiveness ? `
                        <div>
                            <h4>Board Committees</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem;">
                                ${governance.board_committee_effectiveness.audit_committee ? `
                                <div style="padding: 1rem; background: #e8f5e8; border-radius: var(--border-radius);">
                                    <h5>Audit Committee</h5>
                                    ${governance.board_committee_effectiveness.audit_committee.effectiveness_rating ? `<p>Rating: ${governance.board_committee_effectiveness.audit_committee.effectiveness_rating}</p>` : ''}
                                </div>
                                ` : ''}
                                
                                ${governance.board_committee_effectiveness.risk_committee ? `
                                <div style="padding: 1rem; background: #fff3e0; border-radius: var(--border-radius);">
                                    <h5>Risk Committee</h5>
                                    ${governance.board_committee_effectiveness.risk_committee.effectiveness ? `<p>Effectiveness: ${governance.board_committee_effectiveness.risk_committee.effectiveness}</p>` : ''}
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
                
                ${enhancedAudit.key_audit_matters_extraction?.length > 0 ? `
                <div>
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Key Audit Matters (KAMs)</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                        ${enhancedAudit.key_audit_matters_extraction.map(kam => `
                            <div style="padding: 1rem; background: #fff3e0; border-radius: var(--border-radius); border-left: 4px solid var(--warning-color);">
                                <h4 style="color: var(--warning-color); margin-bottom: 0.5rem;">KAM ${kam.kam_number || ''}</h4>
                                ${kam.description ? `<p><strong>Description:</strong> ${kam.description}</p>` : ''}
                                ${kam.auditor_response ? `<p><strong>Auditor Response:</strong> ${kam.auditor_response}</p>` : ''}
                                ${kam.frca_risk_assessment ? `<p><strong>FRC Risk Assessment:</strong> ${kam.frca_risk_assessment}</p>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            `;
        }

        // Update material departures
        function updateMaterialDepartures() {
            const departuresContent = document.getElementById('departuresContent');
            const departures = companyData[16]?.frc_analysis_report?.entity?.phase_5_synthesis_and_findings?.material_departures_summary || [];
            const consolidated = companyData[24]?.frc_analysis_report?.entity?.phase_5_synthesis_and_findings?.consolidated_material_departures || [];
            const nonCompliance = companyData[24]?.frc_analysis_report?.entity?.phase_5_synthesis_and_findings?.non_compliance_with_laws_regulations || [];
            
            departuresContent.innerHTML = `
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Material Departures from IFRS</h3>
                    ${(departures.length > 0 || consolidated.length > 0) ? `
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Description</th>
                                    <th>Standard</th>
                                    <th>Materiality</th>
                                    <th>Financial Impact</th>
                                    <th>Action Required</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${[...departures, ...consolidated].map(item => `
                                    <tr>
                                        <td>${item.issue_id || item.departure_id || 'N/A'}</td>
                                        <td>${item.description || item.nature_of_departure || 'N/A'}</td>
                                        <td>${item.relevant_standard || item.ifrs_standard || 'N/A'}</td>
                                        <td>
                                            <span class="status-badge ${getMaterialityClass(item.materiality)}">
                                                ${item.materiality || 'N/A'}
                                            </span>
                                        </td>
                                        <td>${item.financial_impact_estimate || item.financial_impact_estimate || 'N/A'}</td>
                                        <td>${item.recommended_action || item.corrective_action_required || 'N/A'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    ` : `
                    <div class="empty-state">
                        <p>No material departures identified for this company.</p>
                    </div>
                    `}
                </div>
                
                ${nonCompliance.length > 0 ? `
                <div>
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Non-Compliance with Laws & Regulations</h3>
                    <div style="max-height: 300px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Law/Regulation</th>
                                    <th>Section Violated</th>
                                    <th>Nature of Breach</th>
                                    <th>Severity</th>
                                    <th>Remediation</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${nonCompliance.map(item => `
                                    <tr>
                                        <td>${item.compliance_id || 'N/A'}</td>
                                        <td>${item.law_regulation || 'N/A'}</td>
                                        <td>${item.section_violated || 'N/A'}</td>
                                        <td>${item.nature_of_breach || 'N/A'}</td>
                                        <td>
                                            <span class="status-badge ${getSeverityClass(item.severity_assessment)}">
                                                ${item.severity_assessment || 'N/A'}
                                            </span>
                                        </td>
                                        <td>${item.remediation_required || 'N/A'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                ` : ''}
            `;
        }

        // Update analysis overview
        function updateAnalysisOverview() {
            const analysisContent = document.getElementById('analysisContent');
            const synthesis = companyData[25]?.frc_analysis_report?.entity?.phase_5_synthesis_and_findings?.holistic_risk_factor_synthesis || {};
            const skepticism = companyData[23]?.frc_analysis_report?.entity?.professional_skepticism_application || {};
            
            analysisContent.innerHTML = `
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Holistic Risk Factor Synthesis</h3>
                    ${synthesis.overall_integrated_risk_assessment ? `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        ${synthesis.financial_risks_from_analysis?.consolidated_financial_risk_level ? `
                        <div class="risk-category ${getRiskClass(synthesis.financial_risks_from_analysis.consolidated_financial_risk_level)}">
                            <h3>Financial Risks</h3>
                            <p><strong>Risk Level:</strong> ${synthesis.financial_risks_from_analysis.consolidated_financial_risk_level}</p>
                            ${synthesis.financial_risks_from_analysis.from_ratio_trends?.length > 0 ? `
                            <h4>From Ratio Trends:</h4>
                            <ul class="risk-list">
                                ${synthesis.financial_risks_from_analysis.from_ratio_trends.map(risk => `<li>${risk}</li>`).join('')}
                            </ul>
                            ` : ''}
                        </div>
                        ` : ''}
                        
                        ${synthesis.operational_risks?.consolidated_operational_risk_level ? `
                        <div class="risk-category ${getRiskClass(synthesis.operational_risks.consolidated_operational_risk_level)}">
                            <h3>Operational Risks</h3>
                            <p><strong>Risk Level:</strong> ${synthesis.operational_risks.consolidated_operational_risk_level}</p>
                            ${synthesis.operational_risks.from_related_party_transactions?.length > 0 ? `
                            <h4>From Related Party Transactions:</h4>
                            <ul class="risk-list">
                                ${synthesis.operational_risks.from_related_party_transactions.map(risk => `<li>${risk}</li>`).join('')}
                            </ul>
                            ` : ''}
                        </div>
                        ` : ''}
                        
                        ${synthesis.compliance_risks?.consolidated_compliance_risk_level ? `
                        <div class="risk-category ${getRiskClass(synthesis.compliance_risks.consolidated_compliance_risk_level)}">
                            <h3>Compliance Risks</h3>
                            <p><strong>Risk Level:</strong> ${synthesis.compliance_risks.consolidated_compliance_risk_level}</p>
                            ${synthesis.compliance_risks.from_ifrs_departures?.length > 0 ? `
                            <h4>From IFRS Departures:</h4>
                            <ul class="risk-list">
                                ${synthesis.compliance_risks.from_ifrs_departures.map(risk => `<li>${risk}</li>`).join('')}
                            </ul>
                            ` : ''}
                        </div>
                        ` : ''}
                    </div>
                    ` : '<p>No risk synthesis data available.</p>'}
                </div>
                
                ${skepticism.overall_skepticism_applied ? `
                <div>
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Professional Skepticism Application</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        ${skepticism.areas_of_high_concern?.length > 0 ? `
                        <div style="padding: 1rem; background: #ffebee; border-radius: var(--border-radius);">
                            <h4 style="color: var(--danger-color);">High Concern Areas</h4>
                            <ul>
                                ${skepticism.areas_of_high_concern.map(area => `<li>${area}</li>`).join('')}
                            </ul>
                        </div>
                        ` : ''}
                        
                        ${skepticism.areas_of_moderate_concern?.length > 0 ? `
                        <div style="padding: 1rem; background: #fff3e0; border-radius: var(--border-radius);">
                            <h4 style="color: var(--warning-color);">Moderate Concern Areas</h4>
                            <ul>
                                ${skepticism.areas_of_moderate_concern.map(area => `<li>${area}</li>`).join('')}
                            </ul>
                        </div>
                        ` : ''}
                        
                        ${skepticism.areas_of_low_concern?.length > 0 ? `
                        <div style="padding: 1rem; background: #e8f5e8; border-radius: var(--border-radius);">
                            <h4 style="color: var(--success-color);">Low Concern Areas</h4>
                            <ul>
                                ${skepticism.areas_of_low_concern.map(area => `<li>${area}</li>`).join('')}
                            </ul>
                        </div>
                        ` : ''}
                    </div>
                    
                    ${skepticism.skepticism_conclusion ? `
                    <div style="padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius);">
                        <h4>Overall Skepticism Conclusion</h4>
                        <p>${skepticism.skepticism_conclusion}</p>
                    </div>
                    ` : ''}
                </div>
                ` : ''}
            `;
        }

        // Update compliance dashboard
        function updateComplianceDashboard() {
            const complianceContent = document.getElementById('complianceContent');
            const taxCompliance = companyData[12]?.frc_analysis_report?.entity?.phase_3_ifrs_compliance_detailed?.tax_compliance_check || {};
            const legalMapping = companyData[15]?.frc_analysis_report?.entity?.legal_and_enforcement_mapping || {};
            
            complianceContent.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                    <div>
                        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Tax Compliance</h3>
                        ${taxCompliance.bangladesh_income_tax_act_2023 ? `
                        <div style="padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius);">
                            <h4>Bangladesh Income Tax Act 2023</h4>
                            ${taxCompliance.bangladesh_income_tax_act_2023.withholding_tax_compliance ? `
                            <p><strong>Withholding Tax Compliance:</strong> ${taxCompliance.bangladesh_income_tax_act_2023.withholding_tax_compliance}</p>
                            ` : ''}
                            ${taxCompliance.bangladesh_income_tax_act_2023.advance_tax_status ? `
                            <p><strong>Advance Tax Status:</strong> ${taxCompliance.bangladesh_income_tax_act_2023.advance_tax_status}</p>
                            ` : ''}
                            ${taxCompliance.bangladesh_income_tax_act_2023.overall_tax_compliance_assessment ? `
                            <p><strong>Overall Assessment:</strong> ${taxCompliance.bangladesh_income_tax_act_2023.overall_tax_compliance_assessment}</p>
                            ` : ''}
                        </div>
                        ` : '<p>No tax compliance data available.</p>'}
                    </div>
                    
                    <div>
                        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Legal & Enforcement Mapping</h3>
                        ${legalMapping.financial_reporting_act_2015 ? `
                        <div style="margin-bottom: 1rem;">
                            <h4>Financial Reporting Act 2015</h4>
                            <div style="padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius);">
                                ${legalMapping.financial_reporting_act_2015.severity_assessment ? `
                                <p><strong>Severity Assessment:</strong> 
                                    <span class="status-badge ${getSeverityClass(legalMapping.financial_reporting_act_2015.severity_assessment)}">
                                        ${legalMapping.financial_reporting_act_2015.severity_assessment}
                                    </span>
                                </p>
                                ` : ''}
                                ${legalMapping.financial_reporting_act_2015.nature_of_breach ? `
                                <p><strong>Nature of Breach:</strong> ${legalMapping.financial_reporting_act_2015.nature_of_breach}</p>
                                ` : ''}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${legalMapping.companies_act_1994 ? `
                        <div>
                            <h4>Companies Act 1994</h4>
                            <div style="padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius);">
                                ${legalMapping.companies_act_1994.director_liability_assessed !== undefined ? `
                                <p><strong>Director Liability Assessed:</strong> ${legalMapping.companies_act_1994.director_liability_assessed ? 'Yes' : 'No'}</p>
                                ` : ''}
                                ${legalMapping.companies_act_1994.liability_nature ? `
                                <p><strong>Liability Nature:</strong> ${legalMapping.companies_act_1994.liability_nature}</p>
                                ` : ''}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Update risk assessment
        function updateRiskAssessment() {
            const riskContent = document.getElementById('riskContent');
            const fraudRisk = companyData[13]?.frc_analysis_report?.entity?.fraud_and_management_override_assessment || {};
            const goingConcern = companyData[16]?.frc_analysis_report?.entity?.phase_5_synthesis_and_findings?.going_concern_final_assessment || {};
            
            riskContent.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                    <div>
                        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Fraud Risk Assessment</h3>
                        ${fraudRisk.overall_fraud_risk_assessment ? `
                        <div style="padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius); margin-bottom: 1rem;">
                            <p><strong>Overall Assessment:</strong> ${fraudRisk.overall_fraud_risk_assessment}</p>
                        </div>
                        ` : ''}
                        
                        ${fraudRisk.fraud_risk_factors_identified?.length > 0 ? `
                        <div>
                            <h4>Fraud Risk Factors Identified</h4>
                            <ul style="list-style: none;">
                                ${fraudRisk.fraud_risk_factors_identified.map(factor => `
                                    <li style="padding: 0.5rem 0; border-bottom: 1px solid #eee;">
                                        <i class="fas fa-exclamation-triangle" style="color: var(--warning-color); margin-right: 0.5rem;"></i>${factor}
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div>
                        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">Going Concern Assessment</h3>
                        ${goingConcern.frc_conclusion ? `
                        <div style="padding: 1rem; background: #f8f9fa; border-radius: var(--border-radius);">
                            <p><strong>FRC Conclusion:</strong> ${goingConcern.frc_conclusion}</p>
                            ${goingConcern.recommendation ? `<p><strong>Recommendation:</strong> ${goingConcern.recommendation}</p>` : ''}
                        </div>
                        ` : '<p>No going concern assessment data available.</p>'}
                        
                        ${goingConcern.supporting_factors?.length > 0 || goingConcern.contradicting_factors?.length > 0 ? `
                        <div style="margin-top: 1rem;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                ${goingConcern.supporting_factors?.length > 0 ? `
                                <div style="padding: 1rem; background: #e8f5e8; border-radius: var(--border-radius);">
                                    <h4 style="color: var(--success-color);">Supporting Factors</h4>
                                    <ul>
                                        ${goingConcern.supporting_factors.map(factor => `<li>${factor}</li>`).join('')}
                                    </ul>
                                </div>
                                ` : ''}
                                
                                ${goingConcern.contradicting_factors?.length > 0 ? `
                                <div style="padding: 1rem; background: #ffebee; border-radius: var(--border-radius);">
                                    <h4 style="color: var(--danger-color);">Contradicting Factors</h4>
                                    <ul>
                                        ${goingConcern.contradicting_factors.map(factor => `<li>${factor}</li>`).join('')}
                                    </ul>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Update raw data viewer
        function updateRawDataViewer() {
            const jsonViewer = document.getElementById('jsonViewer');
            
            // Set up JSON section selector change handler
            document.getElementById('jsonSectionSelect').addEventListener('change', function(e) {
                const section = e.target.value;
                displayJSONData(section);
            });
            
            // Display initial JSON data
            displayJSONData('all');
        }

        // Display JSON data in the viewer
        function displayJSONData(section) {
            const jsonViewer = document.getElementById('jsonViewer');
            
            try {
                if (section === 'all') {
                    // Display all sections
                    jsonViewer.textContent = JSON.stringify(companyData, null, 2);
                } else {
                    // Display specific section
                    const sectionNum = parseInt(section);
                    if (companyData[sectionNum]) {
                        jsonViewer.textContent = JSON.stringify(companyData[sectionNum], null, 2);
                    } else {
                        jsonViewer.textContent = `No data available for section ${section}`;
                    }
                }
                
                // Apply syntax highlighting (basic)
                const jsonText = jsonViewer.textContent;
                let highlighted = jsonText
                    .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?)/g, '<span style="color: #d32f2f;">$1</span>')
                    .replace(/\b(true|false|null)\b/g, '<span style="color: #1976d2;">$1</span>')
                    .replace(/\b(\d+)\b/g, '<span style="color: #388e3c;">$1</span>');
                
                jsonViewer.innerHTML = highlighted;
            } catch (error) {
                jsonViewer.textContent = 'Error displaying JSON data: ' + error.message;
            }
        }

        // Helper functions
        function getRiskColor(risk) {
            risk = risk.toLowerCase();
            if (risk.includes('high') || risk.includes('critical')) return 'var(--danger-color)';
            if (risk.includes('medium')) return 'var(--warning-color)';
            if (risk.includes('low')) return 'var(--success-color)';
            return '#333';
        }

        function getRiskClass(risk) {
            risk = risk.toLowerCase();
            if (risk.includes('high') || risk.includes('critical')) return 'high';
            if (risk.includes('medium')) return 'medium';
            if (risk.includes('low')) return 'low';
            return '';
        }

        function getPriorityColor(priority) {
            priority = priority.toLowerCase();
            if (priority.includes('critical')) return 'var(--danger-color)';
            if (priority.includes('high')) return 'var(--warning-color)';
            if (priority.includes('medium')) return '#ff9800';
            return '#333';
        }

        function getComplianceClass(status) {
            if (!status) return '';
            status = status.toLowerCase();
            if (status.includes('compliant')) return 'compliant';
            if (status.includes('partial')) return 'partial';
            if (status.includes('non')) return 'non-compliant';
            return '';
        }

        function getMaterialityClass(materiality) {
            if (!materiality) return '';
            materiality = materiality.toLowerCase();
            if (materiality.includes('material')) return 'status-high';
            if (materiality.includes('immaterial')) return 'status-low';
            return '';
        }

        function getSeverityClass(severity) {
            if (!severity) return '';
            severity = severity.toLowerCase();
            if (severity.includes('high')) return 'status-high';
            if (severity.includes('medium')) return 'status-medium';
            if (severity.includes('low')) return 'status-low';
            return '';
        }

        function generateRatioRows(enhancedRatios, basicRatios) {
            const rows = [];
            
            // Liquidity ratios
            if (enhancedRatios.liquidity_ratios?.current_ratio) {
                rows.push(`
                    <tr>
                        <td><strong>Current Ratio</strong></td>
                        <td>${enhancedRatios.liquidity_ratios.current_ratio.yyyy || basicRatios.ratio_analysis?.current_ratio || 'N/A'}</td>
                        <td>${enhancedRatios.liquidity_ratios.current_ratio.yyyy_1 || 'N/A'}</td>
                        <td>${enhancedRatios.liquidity_ratios.current_ratio.trend || 'N/A'}</td>
                        <td>${enhancedRatios.liquidity_ratios.current_ratio.risk_assessment || 'N/A'}</td>
                    </tr>
                `);
            }
            
            // Debt to Equity
            if (enhancedRatios.solvency_coverage_ratios?.debt_to_equity) {
                rows.push(`
                    <tr>
                        <td><strong>Debt to Equity</strong></td>
                        <td>${enhancedRatios.solvency_coverage_ratios.debt_to_equity.yyyy || basicRatios.ratio_analysis?.debt_to_equity || 'N/A'}</td>
                        <td>${enhancedRatios.solvency_coverage_ratios.debt_to_equity.yyyy_1 || 'N/A'}</td>
                        <td>${enhancedRatios.solvency_coverage_ratios.debt_to_equity.trend_analysis || 'N/A'}</td>
                        <td>${enhancedRatios.solvency_coverage_ratios.debt_to_equity.risk_level || 'N/A'}</td>
                    </tr>
                `);
            }
            
            // ROA
            if (enhancedRatios.profitability_ratios?.return_on_assets_roa) {
                rows.push(`
                    <tr>
                        <td><strong>Return on Assets (ROA)</strong></td>
                        <td>${enhancedRatios.profitability_ratios.return_on_assets_roa.yyyy || basicRatios.ratio_analysis?.roa || 'N/A'}</td>
                        <td>${enhancedRatios.profitability_ratios.return_on_assets_roa.yyyy_1 || 'N/A'}</td>
                        <td>N/A</td>
                        <td>${enhancedRatios.profitability_ratios.return_on_assets_roa.analysis || 'N/A'}</td>
                    </tr>
                `);
            }
            
            // ROE
            if (enhancedRatios.profitability_ratios?.return_on_equity_roe) {
                rows.push(`
                    <tr>
                        <td><strong>Return on Equity (ROE)</strong></td>
                        <td>${enhancedRatios.profitability_ratios.return_on_equity_roe.yyyy || basicRatios.ratio_analysis?.roe || 'N/A'}</td>
                        <td>${enhancedRatios.profitability_ratios.return_on_equity_roe.yyyy_1 || 'N/A'}</td>
                        <td>N/A</td>
                        <td>${enhancedRatios.profitability_ratios.return_on_equity_roe.analysis || 'N/A'}</td>
                    </tr>
                `);
            }
            
            // Net Profit Margin
            if (enhancedRatios.profitability_ratios?.net_profit_margin) {
                rows.push(`
                    <tr>
                        <td><strong>Net Profit Margin</strong></td>
                        <td>${enhancedRatios.profitability_ratios.net_profit_margin.yyyy || basicRatios.ratio_analysis?.net_profit_margin || 'N/A'}</td>
                        <td>${enhancedRatios.profitability_ratios.net_profit_margin.yyyy_1 || 'N/A'}</td>
                        <td>${enhancedRatios.profitability_ratios.net_profit_margin.trend || 'N/A'}</td>
                        <td>${enhancedRatios.profitability_ratios.net_profit_margin.competitive_position || 'N/A'}</td>
                    </tr>
                `);
            }
            
            // Interest Coverage
            if (enhancedRatios.solvency_coverage_ratios?.interest_coverage_ratio) {
                rows.push(`
                    <tr>
                        <td><strong>Interest Coverage Ratio</strong></td>
                        <td>${enhancedRatios.solvency_coverage_ratios.interest_coverage_ratio.yyyy || basicRatios.ratio_analysis?.interest_coverage || 'N/A'}</td>
                        <td>${enhancedRatios.solvency_coverage_ratios.interest_coverage_ratio.yyyy_1 || 'N/A'}</td>
                        <td>N/A</td>
                        <td>${enhancedRatios.solvency_coverage_ratios.interest_coverage_ratio.sustainability_assessment || 'N/A'}</td>
                    </tr>
                `);
            }
            
            // Add additional ratios if basic ones exist but enhanced don't
            if (basicRatios.ratio_analysis) {
                const basic = basicRatios.ratio_analysis;
                if (basic.gross_profit_margin && !rows.some(r => r.includes('Gross Profit'))) {
                    rows.push(`
                        <tr>
                            <td><strong>Gross Profit Margin</strong></td>
                            <td>${basic.gross_profit_margin}</td>
                            <td>N/A</td>
                            <td>N/A</td>
                            <td>N/A</td>
                        </tr>
                    `);
                }
            }
            
            return rows.join('');
        }

        function filterIFRSTable(searchTerm) {
            const table = document.querySelector('#ifrsContent table');
            if (!table) return;
            
            const rows = table.querySelectorAll('tbody tr');
            searchTerm = searchTerm.toLowerCase();
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('lastUpdatedDate').textContent = 
                now.toLocaleDateString('en-GB', { 
                    day: '2-digit', 
                    month: 'short', 
                    year: 'numeric' 
                });
        }

        function showEmptyState() {
            document.getElementById('dashboardContent').style.display = 'none';
            document.getElementById('loading').style.display = 'none';
            document.getElementById('emptyState').style.display = 'block';
        }
    </script>
</body>
</html>